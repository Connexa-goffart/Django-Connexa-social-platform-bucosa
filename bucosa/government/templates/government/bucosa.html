{% extends 'base.html' %}
{% load static %}
{% load display_name %}
{% block content %}
<!-- Banner Section -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<div class="relative w-full bg-gradient-to-b from-indigo-50 to-indigo-100 shadow-lg rounded-b-2xl">
  <div class="relative w-full h-64 md:h-80 flex items-center justify-center overflow-hidden rounded-b-2xl">
    {% if current_gov and current_gov.image %}
      <img src="{{ current_gov.image.url }}" alt="Profile Background" class="absolute left-1/2 top-1/2 w-full h-full object-cover -translate-x-1/2 -translate-y-1/2 scale-105 z-0 transition-transform duration-500" style="opacity: 0.97; filter: none;">
    {% else %}
      <img src="{% static 'images/profile_bg.png' %}" alt="Profile Background" class="absolute left-1/2 top-1/2 w-full h-full object-cover -translate-x-1/2 -translate-y-1/2 scale-105 z-0 transition-transform duration-500" style="opacity: 0.97; filter: none;">
    {% endif %}
  </div>
  <div class="absolute left-8 bottom-[-60px] md:bottom-[-80px] z-30">
    <div class="w-32 h-32 md:w-40 md:h-40 rounded-full border-4 border-white overflow-hidden bg-white shadow-2xl flex items-center justify-center">
      {% if current_gov and current_gov.image %}
        <img src="{{ current_gov.image.url }}" alt="Current Government" class="w-full h-full object-cover">
      {% else %}
        <img src="{% static 'images/default.jpg' %}" alt="Default" class="w-full h-full object-cover">
      {% endif %}
    </div>
  </div>
</div>

<!-- Main Content -->
<div class="container mx-auto pt-20 pb-12 px-4">
  <div class="flex flex-col gap-2 md:gap-8">
    <div class="flex-1">
      <h1 class="text-5xl font-extrabold text-indigo-900 mb-1 leading-tight">{{ current_gov.name|default:'BUCOSA' }}</h1>
      <div class="text-indigo-600 text-xl mb-2">@{{ current_gov.slug|default:'bucosa' }}</div>
      <div class="flex gap-3 mb-3">
        <span class="inline-block w-7 h-2 rounded-full bg-indigo-300"></span>
        <span class="inline-block w-7 h-2 rounded-full bg-purple-300"></span>
      </div>
      <a href="#mission" class="text-indigo-700 font-semibold hover:underline mb-1 block">Mission</a>
      <p id="mission" class="text-xl text-indigo-800 italic mb-4">{{ current_gov.mission }}</p>
      <div class="flex flex-row gap-3 mt-2">
        {% for req in approved_join_requests %}
          <a href="{% url 'users:profile' req.user.id %}" target="_blank" class="group block">
            <div class="w-16 h-16 rounded-full bg-white flex items-center justify-center overflow-hidden border-4 border-indigo-200 shadow-lg group-hover:shadow-xl transition">
              {% if req.user.profile.profile_image %}
                <img src="{{ req.user.profile.profile_image.url }}" alt="{{ req.user|display_name }}" class="w-full h-full object-cover" />
              {% else %}
                <span class="text-2xl font-bold text-indigo-600">{{ req.user|display_name|slice:':1'|upper }}</span>
              {% endif %}
            </div>
          </a>
        {% endfor %}
      </div>
    </div>
  </div>
  {% if request.user.is_superuser %}
  <div class="mb-8">
      <h3 class="text-xl font-semibold mb-2 text-gray-800">Bucosa Admin Dashboard</h3>
      <div class="flex flex-row flex-wrap gap-4 mb-4">
          <a href="{% url 'admin_manage_requests' %}" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg font-semibold shadow">Manage Join Requests</a>
          <a href="{% url 'admin_create_current_government' %}" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg font-semibold shadow">Create Current Government</a>
          <a href="{% url 'admin_create_past_government' %}" class="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg font-semibold shadow">Create Past Government</a>
          <a href="{% url 'edit_current_government' %}" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg font-semibold shadow">Edit Current Government</a>
          <form action="{% url 'delete_current_government' %}" method="post" style="display:inline;">
              {% csrf_token %}
              <button type="submit" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg font-semibold ml-2 shadow" onclick="return confirm('Are you sure you want to delete the current government?');">Delete Current Government</button>
          </form>
      </div>
      {% if not current_gov %}
      <div class="mb-4">
          <a href="{% url 'admin_create_current_government' %}" class="bg-green-700 hover:bg-green-800 text-white px-6 py-3 rounded-lg font-bold text-lg shadow">+ Create Current Government Now</a>
      </div>
      {% endif %}
  </div>
  {% endif %}
  <div class="mb-8">
      {% if not user_has_joined %}
          <h2 class="text-2xl font-bold mb-2 text-gray-800">Request to Join Bucosa</h2>
          {% if user_has_pending_or_approved_request %}
              <p class="text-yellow-600">Your join request is pending or already approved.</p>
          {% else %}
              <form method="post">
                  {% csrf_token %}
                  <button type="submit" name="join_bucosa" class="bg-blue-600 text-white px-4 py-2 rounded shadow">Request to Join</button>
              </form>
          {% endif %}
      {% endif %}
  </div>
  {% if current_gov %}
      <h3 class="text-xl font-semibold mb-2 flex items-center justify-between text-gray-800">
          Members
          {% if request.user.is_superuser %}
          <button onclick="document.getElementById('addMemberModal').classList.remove('hidden')" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-semibold ml-4 shadow">+ Add Member</button>
          {% endif %}
      </h3>
      <div class="overflow-x-auto mb-8 rounded-lg shadow-lg">
        <table class="min-w-full bg-white text-black rounded shadow table-auto">
            <thead class="bg-gray-50">
                <tr>
                    <th class="py-3 px-4 border-b text-center">Photo</th>
                    <th class="py-3 px-4 border-b text-center">Name</th>
                    <th class="py-3 px-4 border-b text-center">Ministry</th>
                    <th class="py-3 px-4 border-b text-center">Contact</th>
                    {% if request.user.is_superuser %}
                    <th class="py-3 px-4 border-b text-center">Actions</th>
                    {% endif %}
                </tr>
            </thead>
            <tbody>
                {% for member in gov_members %}
                <tr class="hover:bg-blue-50 transition">
                    <td class="py-2 px-4 border-b text-center align-middle">
                        {% if member.user.profile.profile_image %}
                            <a href="{% url 'users:profile' member.user.id %}" target="_blank">
                                <img src="{{ member.user.profile.profile_image.url }}" alt="{{ member.name|default:member.user|display_name }}" class="w-12 h-12 object-cover rounded-full border border-gray-300 shadow hover:scale-110 transition mx-auto">
                            </a>
                        {% else %}
                            <span class="inline-block w-12 h-12 bg-gray-300 rounded-full mx-auto"></span>
                        {% endif %}
                    </td>
                    <td class="py-2 px-4 border-b text-center align-middle font-semibold text-blue-900">
                        {{ member.name|default:member.user|display_name }}
                    </td>
                    <td class="py-2 px-4 border-b text-center align-middle text-gray-800">{{ member.ministry }}</td>
                    <td class="py-2 px-4 border-b text-center align-middle text-gray-800">{{ member.contact }}</td>
                    {% if request.user.is_superuser %}
                    <td class="py-2 px-4 border-b text-center align-middle">
                        <a href="{% url 'edit_member' member.id %}" class="text-blue-600 hover:underline mr-2 font-semibold">Edit</a>
                        <form action="{% url 'delete_member' member.id %}" method="post" style="display:inline;">
                            {% csrf_token %}
                            <button type="submit" class="text-red-600 hover:underline font-semibold" onclick="return confirm('Are you sure you want to delete this member?');">Delete</button>
                        </form>
                    </td>
                    {% endif %}
                </tr>
                {% empty %}
                <tr><td colspan="{% if request.user.is_superuser %}5{% else %}4{% endif %}" class="py-2 px-4 text-center">No members found.</td></tr>
                {% endfor %}
            </tbody>
        </table>
      </div>
      {% if request.user.is_superuser %}
      <!-- Add Member Modal (hidden by default) -->
      <div id="addMemberModal" class="fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50 hidden">
          <div class="bg-white rounded-lg shadow-lg p-8 w-full max-w-md relative">
              <button onclick="document.getElementById('addMemberModal').classList.add('hidden')" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
              <h2 class="text-xl font-bold mb-4 text-gray-800">Add Government Member</h2>
              <form method="post" action="{% url 'add_member' %}">
                  {% csrf_token %}
                  <div class="mb-4">
                      <label class="block mb-1 font-semibold text-gray-700">Name (displayed in table)</label>
                      <input type="text" name="name" class="w-full border rounded px-3 py-2" required>
                  </div>
                  <div class="mb-4">
                      <label class="block mb-1 font-semibold text-gray-700">User (username or email)</label>
                      <input type="text" name="user_identifier" class="w-full border rounded px-3 py-2" required>
                  </div>
                  <div class="mb-4">
                      <label class="block mb-1 font-semibold text-gray-700">Ministry</label>
                      <input type="text" name="ministry" class="w-full border rounded px-3 py-2" required>
                  </div>
                  <div class="mb-4">
                      <label class="block mb-1 font-semibold text-gray-700">Contact</label>
                      <input type="text" name="contact" class="w-full border rounded px-3 py-2" required>
                  </div>
                  <button type="submit" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded font-semibold shadow">Add Member</button>
              </form>
          </div>
      </div>
      {% endif %}
  </div>
  {% endif %} <!-- closes 'if current_gov' -->
  {% if request.user.is_superuser %}
  <div class="mt-8">
      <a href="#manage-past-governments" class="text-blue-700 underline text-lg font-bold">Manage Past Governments</a>
      <a href="{% url 'government_history' %}" class="text-blue-700 underline text-lg ml-6">View History of Past Governments</a>
      <div id="manage-past-governments" class="mt-4">
          <style>
            .manage-gov-table {
              width: 100%;
              background: #fff;
              border-radius: 1.25rem;
              box-shadow: 0 4px 24px 0 rgba(0,0,0,0.07);
              border: 1px solid #e5e7eb;
              overflow: hidden;
              margin-top: 1.5rem;
              max-width: 900px;
            }
            .manage-gov-table th, .manage-gov-table td {
              padding: 1rem 1.2rem;
              text-align: left;
            }
            .manage-gov-table th {
              background: #f1f5f9;
              color: #374151;
              font-size: 1.1rem;
              font-weight: 700;
              border-bottom: 2px solid #e5e7eb;
            }
            .manage-gov-table tr {
              transition: background 0.13s;
            }
            .manage-gov-table tr:nth-child(even) {
              background: #f9fafb;
            }
            .manage-gov-table tr:hover {
              background: #f1f5f9;
            }
            .gov-action-view {
              color: #2563eb;
              font-weight: 600;
              text-decoration: none;
              padding: 0.2rem 0.7rem;
              border-radius: 0.4rem;
              background: #e0e7ff;
              transition: background 0.13s, color 0.13s;
              margin-right: 0.3rem;
            }
            .gov-action-view:hover { background: #2563eb; color: #fff; }
            .gov-action-edit {
              color: #d97706;
              font-weight: 600;
              text-decoration: none;
              padding: 0.2rem 0.7rem;
              border-radius: 0.4rem;
              background: #fef3c7;
              transition: background 0.13s, color 0.13s;
              margin-right: 0.3rem;
            }
            .gov-action-edit:hover { background: #d97706; color: #fff; }
            .gov-action-delete {
              color: #dc2626;
              font-weight: 600;
              text-decoration: none;
              padding: 0.2rem 0.7rem;
              border-radius: 0.4rem;
              background: #fee2e2;
              transition: background 0.13s, color 0.13s;
            }
            .gov-action-delete:hover { background: #dc2626; color: #fff; }
          </style>
          <div class="manage-gov-table-wrapper">
            <table class="manage-gov-table">
              <thead>
                <tr>
                  <th style="width:50%">Government Name</th>
                  <th style="width:30%">Actions</th>
                </tr>
              </thead>
              <tbody>
                {% for gov in past_governments %}
                <tr>
                  <td class="font-bold text-blue-900">{{ gov.name }}</td>
                  <td>
                    <a href="{% url 'past_government_detail' gov.id %}" class="gov-action-view">View</a>
                    <a href="{% url 'edit_past_government' gov.id %}" class="gov-action-edit">Edit</a>
                    <form action="{% url 'delete_past_government' gov.id %}" method="post" style="display:inline;">
                      {% csrf_token %}
                      <button type="submit" class="gov-action-delete" onclick="return confirm('Delete this past government?');">Delete</button>
                    </form>
                  </td>
                </tr>
                {% empty %}
                <tr><td colspan="2" class="text-gray-500 italic py-4">No past governments found.</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
      </div>
  </div>
  {% endif %}
{% comment %} End of main content {% endcomment %}
<footer class="bg-gradient-to-r from-indigo-700 to-indigo-900 text-white py-12 mt-16">
  <div class="container mx-auto flex flex-col md:flex-row justify-between items-start md:items-center gap-10 px-6">
    <div class="flex-1 mb-8 md:mb-0">
      <h2 class="text-3xl font-extrabold mb-3 text-yellow-300">BUCOSA FAMILY</h2>
      <p class="mb-2 text-lg">Empowering communities through innovation and excellence.<br>Join us in shaping the future together.</p>
      <div class="social-links flex gap-4 mt-4">
        <a href="https://x.com/Bucosa_family" class="social-link flex items-center justify-center w-11 h-11 rounded-full bg-gradient-to-tr from-indigo-600 to-purple-600 text-white shadow-lg hover:scale-110 hover:from-indigo-700 hover:to-purple-700 transition-all duration-200 border-2 border-white/30" aria-label="X (formerly Twitter)"><i class="fa-brands fa-x-twitter text-2xl"></i></a>
        <a href="https://www.youtube.com/@BucosaFamily" class="social-link flex items-center justify-center w-11 h-11 rounded-full bg-gradient-to-tr from-red-600 to-pink-600 text-white shadow-lg hover:scale-110 hover:from-red-700 hover:to-pink-700 transition-all duration-200 border-2 border-white/30" aria-label="YouTube"><i class="fa-brands fa-youtube text-2xl"></i></a>
        <a href="https://www.instagram.com/bucosa_family/" class="social-link flex items-center justify-center w-11 h-11 rounded-full bg-gradient-to-tr from-pink-500 to-yellow-500 text-white shadow-lg hover:scale-110 hover:from-pink-600 hover:to-yellow-600 transition-all duration-200 border-2 border-white/30" aria-label="Instagram"><i class="fa-brands fa-instagram text-2xl"></i></a>
        <a href="https://www.tiktok.com/@bucosa.familly?lang=en-GB" class="social-link flex items-center justify-center w-11 h-11 rounded-full bg-gradient-to-tr from-gray-800 to-gray-600 text-white shadow-lg hover:scale-110 hover:from-gray-900 hover:to-gray-700 transition-all duration-200 border-2 border-white/30" aria-label="TikTok"><i class="fa-brands fa-tiktok text-2xl"></i></a>
      </div>
    </div>
    <div class="flex-1 flex flex-col md:flex-row gap-10 justify-between">
      <div>
        <h3 class="text-xl font-bold mb-3">Quick Links</h3>
        <ul class="space-y-2">
          <li><a href="#" class="hover:underline">About Us</a></li>
          <li><a href="#" class="hover:underline">Services</a></li>
          <li><a href="#" class="hover:underline">Our Mission</a></li>
          <li><a href="#" class="hover:underline">Blog</a></li>
          <li><a href="{% url 'government_history' %}" class="hover:underline">Our History</a></li>
        </ul>
      </div>
      <div>
        <h3 class="text-xl font-bold mb-3">Support</h3>
        <ul class="space-y-2">
          <li><a href="#" class="hover:underline">Help Center</a></li>
          <li><a href="#" class="hover:underline">Contact Us</a></li>
          <li><a href="#" class="hover:underline">Privacy Policy</a></li>
          <li><a href="#" class="hover:underline">Terms of Service</a></li>
          <li><a href="#" class="hover:underline">FAQ</a></li>
        </ul>
      </div>
    </div>
  </div>
  <hr class="my-8 border-indigo-400 opacity-30">
  <div class="text-center text-indigo-100 text-sm">© 2025 BUCOSA FAMILY. All rights reserved.</div>
</footer>
{% endblock %}
